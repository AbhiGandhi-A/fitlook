{"ast":null,"code":"\"use client\";// Component for virtual try-on with image overlay\nimport{useContext,useRef,useEffect,useState}from\"react\";import{FitLookContext}from\"../App\";import\"../styles/OutfitPreview.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function OutfitPreview(){const{userImage,selectedItems,setCurrentStep}=useContext(FitLookContext);const canvasRef=useRef(null);const[discountApplied,setDiscountApplied]=useState(false);const[discountPercentage,setDiscountPercentage]=useState(0);// Draw outfit preview on canvas\nuseEffect(()=>{if(canvasRef.current&&userImage){const canvas=canvasRef.current;const ctx=canvas.getContext(\"2d\");// Load base image\nconst img=new Image();img.crossOrigin=\"anonymous\";img.onload=()=>{// Set canvas size to match image\ncanvas.width=img.width;canvas.height=img.height;// Draw base image\nctx.drawImage(img,0,0);// Draw selected clothing items as overlays\nif(selectedItems.top&&selectedItems.top.image){drawClothingItem(ctx,selectedItems.top.image,\"top\",img.height);}if(selectedItems.bottom&&selectedItems.bottom.image){drawClothingItem(ctx,selectedItems.bottom.image,\"bottom\",img.height);}if(selectedItems.shoes&&selectedItems.shoes.image){drawClothingItem(ctx,selectedItems.shoes.image,\"shoes\",img.height);}};img.src=userImage;}},[userImage,selectedItems]);// Helper function to draw clothing items on canvas\nconst drawClothingItem=(ctx,itemImage,category,imageHeight)=>{const img=new Image();img.crossOrigin=\"anonymous\";img.onload=()=>{// Position based on category\nlet y=0;const height=imageHeight/3;if(category===\"top\"){y=imageHeight*0.1;}else if(category===\"bottom\"){y=imageHeight*0.4;}else if(category===\"shoes\"){y=imageHeight*0.75;}// Draw with transparency\nctx.globalAlpha=0.8;ctx.drawImage(img,0,y,ctx.canvas.width,height);ctx.globalAlpha=1;};img.src=itemImage;};// Check if complete outfit is selected\nconst isCompleteOutfit=selectedItems.top&&selectedItems.bottom;// Handle complete outfit purchase\nconst handleBuyCompleteOutfit=async()=>{try{var _selectedItems$shoes;const response=await fetch(\"/api/cart/add-outfit\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({topVariantId:selectedItems.top.id,bottomVariantId:selectedItems.bottom.id,shoeVariantId:(_selectedItems$shoes=selectedItems.shoes)===null||_selectedItems$shoes===void 0?void 0:_selectedItems$shoes.id,accessoryVariantIds:selectedItems.accessories.map(a=>a.id)})});if(response.ok){const data=await response.json();window.location.href=data.cartUrl;}}catch(error){console.error(\"Error adding to cart:\",error);alert(\"Failed to add outfit to cart\");}};return/*#__PURE__*/_jsxs(\"div\",{className:\"outfit-preview\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Your Outfit Preview\"}),/*#__PURE__*/_jsx(\"div\",{className:\"preview-container\",children:/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"preview-canvas\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"selected-items-summary\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Selected Items\"}),selectedItems.top&&/*#__PURE__*/_jsxs(\"div\",{className:\"item-summary\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Top:\"}),/*#__PURE__*/_jsx(\"span\",{children:selectedItems.top.title}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",selectedItems.top.price]})]}),selectedItems.bottom&&/*#__PURE__*/_jsxs(\"div\",{className:\"item-summary\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Bottom:\"}),/*#__PURE__*/_jsx(\"span\",{children:selectedItems.bottom.title}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",selectedItems.bottom.price]})]}),selectedItems.shoes&&/*#__PURE__*/_jsxs(\"div\",{className:\"item-summary\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Shoes:\"}),/*#__PURE__*/_jsx(\"span\",{children:selectedItems.shoes.title}),/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",selectedItems.shoes.price]})]})]}),isCompleteOutfit&&/*#__PURE__*/_jsxs(\"div\",{className:\"discount-banner\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Complete the Look!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Get 10% off when you buy the complete outfit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:handleBuyCompleteOutfit,children:\"Buy Complete Outfit\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"preview-actions\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-secondary\",onClick:()=>setCurrentStep(\"catalog\"),children:\"Back to Catalog\"}),!isCompleteOutfit&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>setCurrentStep(\"catalog\"),children:\"Add More Items\"})]})]});}export default OutfitPreview;","map":{"version":3,"names":["useContext","useRef","useEffect","useState","FitLookContext","jsx","_jsx","jsxs","_jsxs","OutfitPreview","userImage","selectedItems","setCurrentStep","canvasRef","discountApplied","setDiscountApplied","discountPercentage","setDiscountPercentage","current","canvas","ctx","getContext","img","Image","crossOrigin","onload","width","height","drawImage","top","image","drawClothingItem","bottom","shoes","src","itemImage","category","imageHeight","y","globalAlpha","isCompleteOutfit","handleBuyCompleteOutfit","_selectedItems$shoes","response","fetch","method","headers","body","JSON","stringify","topVariantId","id","bottomVariantId","shoeVariantId","accessoryVariantIds","accessories","map","a","ok","data","json","window","location","href","cartUrl","error","console","alert","className","children","ref","title","price","onClick"],"sources":["C:/Users/abhig/Downloads/fitlook-app/frontend/src/components/OutfitPreview.jsx"],"sourcesContent":["\"use client\"\n\n// Component for virtual try-on with image overlay\nimport { useContext, useRef, useEffect, useState } from \"react\"\nimport { FitLookContext } from \"../App\"\nimport \"../styles/OutfitPreview.css\"\n\nfunction OutfitPreview() {\n  const { userImage, selectedItems, setCurrentStep } = useContext(FitLookContext)\n  const canvasRef = useRef(null)\n  const [discountApplied, setDiscountApplied] = useState(false)\n  const [discountPercentage, setDiscountPercentage] = useState(0)\n\n  // Draw outfit preview on canvas\n  useEffect(() => {\n    if (canvasRef.current && userImage) {\n      const canvas = canvasRef.current\n      const ctx = canvas.getContext(\"2d\")\n\n      // Load base image\n      const img = new Image()\n      img.crossOrigin = \"anonymous\"\n      img.onload = () => {\n        // Set canvas size to match image\n        canvas.width = img.width\n        canvas.height = img.height\n\n        // Draw base image\n        ctx.drawImage(img, 0, 0)\n\n        // Draw selected clothing items as overlays\n        if (selectedItems.top && selectedItems.top.image) {\n          drawClothingItem(ctx, selectedItems.top.image, \"top\", img.height)\n        }\n\n        if (selectedItems.bottom && selectedItems.bottom.image) {\n          drawClothingItem(ctx, selectedItems.bottom.image, \"bottom\", img.height)\n        }\n\n        if (selectedItems.shoes && selectedItems.shoes.image) {\n          drawClothingItem(ctx, selectedItems.shoes.image, \"shoes\", img.height)\n        }\n      }\n      img.src = userImage\n    }\n  }, [userImage, selectedItems])\n\n  // Helper function to draw clothing items on canvas\n  const drawClothingItem = (ctx, itemImage, category, imageHeight) => {\n    const img = new Image()\n    img.crossOrigin = \"anonymous\"\n    img.onload = () => {\n      // Position based on category\n      let y = 0\n      const height = imageHeight / 3\n\n      if (category === \"top\") {\n        y = imageHeight * 0.1\n      } else if (category === \"bottom\") {\n        y = imageHeight * 0.4\n      } else if (category === \"shoes\") {\n        y = imageHeight * 0.75\n      }\n\n      // Draw with transparency\n      ctx.globalAlpha = 0.8\n      ctx.drawImage(img, 0, y, ctx.canvas.width, height)\n      ctx.globalAlpha = 1\n    }\n    img.src = itemImage\n  }\n\n  // Check if complete outfit is selected\n  const isCompleteOutfit = selectedItems.top && selectedItems.bottom\n\n  // Handle complete outfit purchase\n  const handleBuyCompleteOutfit = async () => {\n    try {\n      const response = await fetch(\"/api/cart/add-outfit\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          topVariantId: selectedItems.top.id,\n          bottomVariantId: selectedItems.bottom.id,\n          shoeVariantId: selectedItems.shoes?.id,\n          accessoryVariantIds: selectedItems.accessories.map((a) => a.id),\n        }),\n      })\n\n      if (response.ok) {\n        const data = await response.json()\n        window.location.href = data.cartUrl\n      }\n    } catch (error) {\n      console.error(\"Error adding to cart:\", error)\n      alert(\"Failed to add outfit to cart\")\n    }\n  }\n\n  return (\n    <div className=\"outfit-preview\">\n      <h2>Your Outfit Preview</h2>\n\n      {/* Canvas for outfit preview */}\n      <div className=\"preview-container\">\n        <canvas ref={canvasRef} className=\"preview-canvas\" />\n      </div>\n\n      {/* Selected items summary */}\n      <div className=\"selected-items-summary\">\n        <h3>Selected Items</h3>\n        {selectedItems.top && (\n          <div className=\"item-summary\">\n            <span>Top:</span>\n            <span>{selectedItems.top.title}</span>\n            <span>${selectedItems.top.price}</span>\n          </div>\n        )}\n        {selectedItems.bottom && (\n          <div className=\"item-summary\">\n            <span>Bottom:</span>\n            <span>{selectedItems.bottom.title}</span>\n            <span>${selectedItems.bottom.price}</span>\n          </div>\n        )}\n        {selectedItems.shoes && (\n          <div className=\"item-summary\">\n            <span>Shoes:</span>\n            <span>{selectedItems.shoes.title}</span>\n            <span>${selectedItems.shoes.price}</span>\n          </div>\n        )}\n      </div>\n\n      {/* Discount banner */}\n      {isCompleteOutfit && (\n        <div className=\"discount-banner\">\n          <h3>Complete the Look!</h3>\n          <p>Get 10% off when you buy the complete outfit</p>\n          <button className=\"btn btn-primary\" onClick={handleBuyCompleteOutfit}>\n            Buy Complete Outfit\n          </button>\n        </div>\n      )}\n\n      {/* Navigation buttons */}\n      <div className=\"preview-actions\">\n        <button className=\"btn btn-secondary\" onClick={() => setCurrentStep(\"catalog\")}>\n          Back to Catalog\n        </button>\n        {!isCompleteOutfit && (\n          <button className=\"btn btn-primary\" onClick={() => setCurrentStep(\"catalog\")}>\n            Add More Items\n          </button>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default OutfitPreview\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}